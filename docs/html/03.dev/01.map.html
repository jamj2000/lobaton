

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.1. Creación de mapas &mdash; documentación de Lobatón - 0.1.0</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="3.2. API" href="02.lib.html" />
    <link rel="prev" title="3. Documentación de desarrollo" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Lobatón
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01.intro/index.html">1. ¿Por qué Lobatón?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02.user/index.html">2. Documentación de usuario</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">3. Documentación de desarrollo</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.1. Creación de mapas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#conceptos-previos">3.1.1. Conceptos previos</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uso-basico">3.1.2. Uso básico</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#preliminares">3.1.2.1. Preliminares</a></li>
<li class="toctree-l4"><a class="reference internal" href="#carga-basica">3.1.2.2. Carga básica</a></li>
<li class="toctree-l4"><a class="reference internal" href="#definicion-del-icono">3.1.2.3. Definición del icono</a></li>
<li class="toctree-l4"><a class="reference internal" href="#acceso-a-marcas">3.1.2.4. Acceso a marcas</a></li>
<li class="toctree-l4"><a class="reference internal" href="#correcciones">3.1.2.5. Correcciones</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filtros">3.1.2.6. Filtros</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#variantes">3.1.3. Variantes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#leaflet-markercluster">3.1.3.1. Leaflet.markercluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datos-que-no-son-geojson">3.1.3.2. Datos que no son GeoJSON</a></li>
<li class="toctree-l4"><a class="reference internal" href="#barra-de-progreso">3.1.3.3. Barra de progreso</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="02.lib.html">3.2. <abbr title="Application Programming Interface">API</abbr></a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Lobatón</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">3. Documentación de desarrollo</a> &raquo;</li>
        
      <li>3.1. Creación de mapas</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/03.dev/01.map.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="creacion-de-mapas">
<h1>3.1. Creación de mapas<a class="headerlink" href="#creacion-de-mapas" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Bajo este epígrafe se hará una exposición didáctica de cómo aprovechar
las ventajas de la librería <code class="file docutils literal notranslate"><span class="pre">leafext.js</span></code> para construir mapas.
De hecho, el <em>mapa de adjudicaciones y oferta educativa</em> es una aplicación
particular de su uso basada en tres niveles:</p>
<ul class="simple">
<li><code class="file docutils literal notranslate"><span class="pre">leafext.js</span></code> en el nivel más bajo y absolutamente genérico.</li>
<li><code class="file docutils literal notranslate"><span class="pre">adjofer/map.js</span></code> para definir en concreto cuáles son los iconos,
cómo se dibujan a partir de los datos y cómo varían en función de las
correcciones y filtros que se apliquen sobre tales datos. Su implementación
Debe ser independiente de cuál sea la herramienta que se use para construir la
interfaz visual.</li>
<li><code class="file docutils literal notranslate"><span class="pre">adjofer/visual/vue.js</span></code> que implementa una interfaz atractiva haciendo
uso de los dos niveles anteriores.</li>
</ul>
<p>Trataremos aquí cómo crear el segundo nivel, aunque para los ejemplos prácticos
tendremos que introducir algún aspecto básico propio del tercero ya que el mapa
se tendrá que ver de alguna forma.</p>
<div class="section" id="conceptos-previos">
<h2>3.1.1. Conceptos previos<a class="headerlink" href="#conceptos-previos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Partimos de la necesidad de representar sobre un mapa una serie de entidades
cada una de las cuales tiene asociado un conjunto de datos. Para ello, podemos
usar <a class="reference external" href="https://leafletjs.com/">Leaflet</a> y colocar una marca por entidad, pero el uso de esta librería (u
otra equivalente) se limitará a permitirnos asignar un icono cuyo aspecto será
independiente de los valores concretos de los datos. Nuestra intención, no
obstanmte, es ligar el aspecto del icono a los datos</p>
<p>En principio, distinguiremos estos conceptos.</p>
<dl class="docutils">
<dt><strong>Datos</strong></dt>
<dd>Incluyen las coordinadas de la entidad y otros datos característicos de los
que se quiere dejar constancia, total o parcialmente, a través del aspecto
visual de la marca.</dd>
<dt><strong>Marca</strong></dt>
<dd>Es la plasmación de la entidad (y sus datos) sobre el mapa.</dd>
<dt><strong>Clase</strong> (o <strong>Estilo</strong>) de marca.</dt>
<dd>Todas las marcas que representen un mismo tipo de entidad pertenecen a una
misma clase de marca. Cada clase tiene, además, asociados un <em>sistema de
correcciones</em> y un <em>sistema de filtros</em>.</dd>
<dt><strong>Sistema de correcciones</strong></dt>
<dd>Sistema que permite registrar, aplicar y revertir correcciones aplicables
a los datos.</dd>
<dt><strong>Sistema de filtros</strong></dt>
<dd>Sistema que permite fijar criterios para hacer desaparecer (o volver a
mostrar) marcas.</dd>
</dl>
<p class="rubric">¿Cuándo puede resultarme útil leafext.js?</p>
<p>La librería se torna útil cuando, dado un conjunto de datos a representar sobre
un mapa:</p>
<ol class="arabic simple">
<li>Se quiere que los iconos que representan datos de un mismo tipo de entidad no
sean exactamente iguales, sino que partiendo de una plantilla sufran
alteraciones en función de loes valores de sus datos.  Por ejemplo, que el
color dependa de lo grande que sea la magnitud del valor correspondiente.</li>
<li>Los datos puede sufrir correcciones por la interacción del usuario, lo cual
por supuesto podrá tener reflejo en el aspecto del icono, si éste dependía de
los datos que cuyo valor ha cambiado.</li>
<li>Parte de los iconos pueden filtrarse y desaparecer, como consecuencia de las
decisiones del usuario.</li>
</ol>
<p>Y, por supuesto, cuando deseamos hacer todo esto conjuntamente. ;-)</p>
<p>Para que se haga una idea, esto es mapa desarrollado con la librería:</p>
<img alt="../_images/iconos.png" src="../_images/iconos.png" />
<p>Todos los iconos representan centros educativos y todos tienen una plantilla
común, pero sus detalles visuales particulares dependen de los datos que cada
uno tiene asociados (algunos son bilingües en inglés y muestran una bandera,
otros son de compensatoria y muestran un pequeño círculo azul, etc.).</p>
</div>
<div class="section" id="uso-basico">
<h2>3.1.2. Uso básico<a class="headerlink" href="#uso-basico" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Quizás pueda servirle de ayuda a la lectura, tener a la vista desde el
principio <a class="reference internal" href="#dev-map-ejmin"><span class="std std-ref">el ejemplo mínimo de aplicación</span></a>.</p>
</div>
<div class="section" id="preliminares">
<h3>3.1.2.1. Preliminares<a class="headerlink" href="#preliminares" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="datos">
<span id="dev-map-data"></span><h4>3.1.2.1.1. Datos<a class="headerlink" href="#datos" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La idea es que disponemos de un conjunto de datos, que describen un conjunto de
entidades localizables en un mapa. Por ejemplo, la entidades pueden ser centros
educativos, de cada uno de lo cuales se conoce su situación geográfica y una
serie de características de interes. Nuestra intención es convertir cada
entidad en una marca dentro del mapa. Consideremos que el formato de los datos
es <a class="reference external" href="http://geojson.org/">GeoJSON</a>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span>
   <span class="nt">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
         <span class="nt">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span>
            <span class="nt">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">-5.9526</span><span class="p">,</span> <span class="mf">37.275475</span><span class="p">]</span>
         <span class="p">},</span>
         <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Centro 1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;adj&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Suprimido&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">],</span>
            <span class="nt">&quot;oferta&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">,</span> <span class="s2">&quot;DAM&quot;</span><span class="p">,</span> <span class="s2">&quot;BACHILLERATO&quot;</span><span class="p">],</span>
            <span class="nt">&quot;tipo&quot;</span><span class="p">:</span> <span class="s2">&quot;normal&quot;</span>
         <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
         <span class="nt">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span>
            <span class="nt">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">-4.6389</span><span class="p">,</span> <span class="mf">37.58434</span><span class="p">]</span>
         <span class="p">},</span>
         <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Centro 2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;adj&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Expectativa&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">],</span>
            <span class="nt">&quot;oferta&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">,</span> <span class="s2">&quot;ASIR&quot;</span><span class="p">],</span>
            <span class="nt">&quot;tipo&quot;</span><span class="p">:</span> <span class="s2">&quot;dificil&quot;</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">No es requisito que los datos tengan este formato, pero es un
estándar y <a class="reference external" href="https://leafletjs.com/">Leaflet</a> dispone de <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#geojson">un tipo de capa</a> que es capaz de
interpretarlos directamente generando una marca y conectando los datos
a ella a través de la propiedad <code class="docutils literal notranslate"><span class="pre">feature</span></code>. En cualquier caso, es posible
tratar un formato cualquiera de datos, creando nosotros mismos la marca
y asociándole sus datos a través de una propiedad.</p>
</div>
</div>
<div class="section" id="requerimientos">
<h4>3.1.2.1.2. Requerimientos<a class="headerlink" href="#requerimientos" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Como es obvio, el uso de la librería exige la carga previa de <a class="reference external" href="https://leafletjs.com/">Leaflet</a>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Leaflet --&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/leaflet@1.4.0/dist/leaflet.css&quot;</span>
      <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==&quot;</span>
       <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/leaflet@1.4.0/dist/leaflet.js&quot;</span>
        <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg==&quot;</span>
        <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>A lo que podríamos añadir nuestros <em>plugins</em> favoritos de <a class="reference external" href="https://leafletjs.com/">Leaflet</a>, y la carga de
nuestra librería y el <em>script</em> donde desarrollaremos la creación del mapa.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Extensión para el soporte de iconos mutables --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../dist/leafext.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="c">&lt;!-- Script particular para este mapa --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;scripts/demo.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Las pautas para escribir este último <em>script</em> (<code class="file docutils literal notranslate"><span class="pre">scripts/demo.js</span></code>) (y el
propio documento <abbr title="HyperText Markup Language">HTML</abbr> claro está) son el propósito de este documento.</p>
<p>También, por supuesto, deberíamos incluir en el <abbr title="HyperText Markup Language">HTML</abbr> un elemento en el que
incrustar el mapa. Típicamente:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="carga-basica">
<h3>3.1.2.2. Carga básica<a class="headerlink" href="#carga-basica" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para cargar el mapa y los datos podemos distinguir cuatro tareas distintas:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Icono</span> <span class="o">=</span> <span class="nx">crearIcono</span><span class="p">();</span>

<span class="nx">map</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="s2">&quot;map&quot;</span><span class="p">).</span><span class="nx">setView</span><span class="p">([</span><span class="mf">37.07</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.27</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">tileLayer</span><span class="p">(</span><span class="s1">&#39;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">18</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="c1">// Y una capa GeoJSON para crear las marcas y conectarles los datos.</span>
<span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span>  <span class="nx">L</span><span class="p">.</span><span class="nx">geoJSON</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">pointToLayer</span><span class="o">:</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nx">Centro</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">icon</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Icono</span><span class="p">(),</span>
      <span class="nx">title</span><span class="o">:</span> <span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
   <span class="p">})</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Marker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span><span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;feature.properties&quot;</span><span class="p">}</span>
<span class="p">});</span>

<span class="nx">layer</span><span class="p">.</span><span class="nx">addData</span><span class="p">(</span><span class="nx">datos</span><span class="p">);</span>
</pre></div>
</div>
<ol class="arabic">
<li><p class="first">La creación del icono, que hemos incluido dentro de la función
<code class="docutils literal notranslate"><span class="pre">crearIcono()</span></code>, a lo que dedicaremos el próximo apartado.</p>
</li>
<li><p class="first">La creación del mapa, que es la habitual con <a class="reference external" href="https://leafletjs.com/">Leaflet</a>.</p>
</li>
<li><p class="first">La creación de una capa para el tratamiento de los datos en formato
<em>GeoJSON</em>. En este caso se ha supuesto que los datos se obtuvieron
previamente de algún modo. Obsérvese cómo se usa la clase de marca
(<code class="docutils literal notranslate"><span class="pre">Centro</span></code>) e icono (<code class="docutils literal notranslate"><span class="pre">Icono</span></code>).  En caso de que el formato de entrada no
sea <a class="reference external" href="http://geojson.org/">GeoJSON</a>, podríamos usar simplemente <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#layergroup">L.LayerGroup</a> o <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#featuregroup">L.FeatureGroup</a>, aunque
tendríamos que ligar manualmente los datos la marca.</p>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last">Vea cómo <a class="reference internal" href="#dev-map-no-geojson"><span class="std std-ref">tratar datos que no tengan formato GeoJSON</span></a>.</p>
</div>
</li>
<li><p class="first">La creación de la marca apropiada que requiere obligatoriamente la inclusión
de la opción <code class="docutils literal notranslate"><span class="pre">mutable</span></code>, cuyo valor debe ser la propiedad de la marca donde
se guardarán los datos asociados a la marca. Dado que usamos como origen de
los datos un objeto <a class="reference external" href="http://geojson.org/">GeoJSON</a> y los añadimos al mapa mediante una capa
<a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#geojson">L.GeoJSON</a> , éstos aparecerán dentro de <code class="docutils literal notranslate"><span class="pre">feature.properties</span></code>, así que es
ahí donde indicamos que se deben buscar los datos. Resumiendo:</p>
<ul>
<li><p class="first">Al pasar la opción <code class="docutils literal notranslate"><span class="pre">mutable</span></code> la marca añadirá los métodos y propiedades
precisos para tratar la mutabilidad de los iconos. Si no se pasa tal opción,
la marca será un <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#marker">L.Marker</a> común y corriente de
<a class="reference external" href="https://leafletjs.com/">LeafLet</a>.</p>
</li>
<li><p class="first">El valor de de la propiedad se tomará como los datos asociados a la marca
y de hecho, tal valor será el que devuelva el método de marca
<a class="reference internal" href="02.lib.html#Marker.getData" title="Marker.getData"><code class="xref js js-meth docutils literal notranslate"><span class="pre">Marker.getData()</span></code></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Si en algún momento requiere consultar los datos y estos
han sufrido alguna corrección, tenga presente que <a class="reference internal" href="#dev-map-correctable"><span class="std std-ref">las propiedades
que sean *arrays* susceptibles de corrección deben consultarse de un
modo particular</span></a>.</p>
</div>
</li>
<li><p class="first">Si no usa el formato <a class="reference external" href="http://geojson.org/">GeoJSON</a> y crear la amrca y añade artesanalmente los
datos, asegúrese de colocar los datos en la propiedad que ha señalado con
<code class="docutils literal notranslate"><span class="pre">mutable</span></code>.</p>
</li>
</ul>
</li>
</ol>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last">Cuando los datos son numerosos y, en consecuencia, las marcas
también, es imprescindible usar la extensión <a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">L.MarkerClusterGroup</a> para agrupar las
marcas cercanas en una sola y que la marca conjunta vaya disgregándose a medida
que aumentamos la escala. Consulte <a class="reference internal" href="#dev-map-cluster"><span class="std std-ref">el uso de esta capa de clusters más
adelante</span></a>.</p>
</div>
</div>
<div class="section" id="definicion-del-icono">
<span id="crear-icono"></span><h3>3.1.2.3. Definición del icono<a class="headerlink" href="#definicion-del-icono" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La definición del icono es la parte más engorrosa de toda la programación, en la medida
en que al ser un icono cuyo aspecto cambia según los datos particulares
asociados a cada marca o según las correcciones que el usuario imponga a estos
datos, hay que definir cuáles son las reglas de cambio. En un icono normal,
además de propiedades adicionales como el tamaño o el punto de anclaje, la propiedad
fundamental es aquella que define cuál es el icono: <code class="docutils literal notranslate"><span class="pre">iconUrl</span></code> para iconos que
se definen como imágenes, y <code class="docutils literal notranslate"><span class="pre">html</span></code> para iconos <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#divicon">L.DivIcon</a>. Para nuestros iconos
diversos y mutables, en cambio, hay que definir también cómo los datos se traducen
en detalles visuales del icono.</p>
<p>En nuestra explicación usemos este sencillo, parecido a un <em>Chupa Chups</em>:</p>
<img alt="../_images/chupachups.png" src="../_images/chupachups.png" />
<p>El icono tiene dos detalles que depende de los datos asociados: el número que
representa el número de adjudicaciones; y el fondo del círculo que es un color
que depende del tipo de centro.</p>
<div class="section" id="ingredientes">
<h4>3.1.2.3.1. Ingredientes<a class="headerlink" href="#ingredientes" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Las opciones que debemos proporcionar en la creación de un estilo<a class="footnote-reference" href="#id10" id="id1">[1]</a> de icono son las siguientes:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">html</span></code> (o bien, <code class="docutils literal notranslate"><span class="pre">url</span></code>)</dt>
<dd><p class="first">Define la plantilla que se usará para crear el icono. Sobre esa plantilla se
realizarán variaciones determinadas por los valores concretos de los datos. Si
se proporciona <code class="docutils literal notranslate"><span class="pre">url</span></code> se entiende que es un fichero donde se ha almacenado
la definición. Un típico caso, sería pasar la <abbr title="Uniform Resource Locator">URL</abbr> a un <abbr title="Scalable Vector Graphics">SVG</abbr>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;images/centro.svg&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">html</span></code>, en cambio, debe usarse cuado la definición de la plantilla se hace:</p>
<ul class="last">
<li><p class="first">A través de una cadena:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;content&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;arrow&quot;&gt;&lt;/div&gt;&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first">A través de un <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentFragment">DocumentFragment</a> que sería el objeto que obtendríamos
si hubiéramos incluido la definición a través de un <a class="reference external" href="template">template</a> <abbr title="HyperText Markup Language">HTML</abbr>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">template</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;icono&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;&lt;</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;arrow&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>que permitiría hacer en el código <em>Javascript</em> esta definición:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;icono&quot;</span><span class="p">).</span><span class="nx">content</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Directamente a través de un <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement">HTMLElement</a><a class="footnote-reference" href="#id11" id="id2">[2]</a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
<span class="nx">content</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;content&quot;</span><span class="p">;</span>
<span class="nx">html</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">arrow</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
<span class="nx">arrow</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;arrow&quot;</span><span class="p">;</span>
<span class="nx">html</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">arrow</span><span class="p">);</span>
<span class="nx">content</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</dd>
</dl>
<dl class="docutils" id="dev-map-css">
<dt><code class="docutils literal notranslate"><span class="pre">css</span></code></dt>
<dd><p class="first">Cuando el icono se define a través de elementos <abbr title="HyperText Markup Language">HTML</abbr> (o sea, todos los
ejemplos anteriores, excepto el icono <abbr title="Scalable Vector Graphics">SVG</abbr>), es preciso indicar las reglas
<abbr title="Cascading Style Sheets">CSS</abbr> que permiten generar el icono:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">css</span> <span class="o">=</span> <span class="s2">&quot;images/chupachups.css&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>El fichero podría ser algo así<a class="footnote-reference" href="#id12" id="id3">[3]</a>:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">chupachups</span> <span class="p">.</span><span class="nc">content</span> <span class="p">{</span>
   <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>
   <span class="k">box-sizing</span><span class="p">:</span> <span class="kc">border-box</span><span class="p">;</span>
   <span class="k">height</span><span class="p">:</span> <span class="mi">70</span><span class="kt">%</span><span class="p">;</span>
   <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
   <span class="k">border-radius</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
   <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
   <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
   <span class="k">justify-content</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
   <span class="k">border</span><span class="p">:</span> <span class="kc">solid</span> <span class="mi">3</span><span class="kt">px</span> <span class="mh">#888</span><span class="p">;</span>
   <span class="k">font-weight</span><span class="p">:</span> <span class="kc">bold</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">chupachups</span> <span class="p">.</span><span class="nc">arrow</span> <span class="p">{</span>
   <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>
   <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">width</span><span class="p">:</span> <span class="mi">10</span><span class="kt">%</span><span class="p">;</span> <span class="k">height</span><span class="p">:</span> <span class="mi">30</span><span class="kt">%</span><span class="p">;</span>
   <span class="k">left</span><span class="p">:</span> <span class="mi">45</span><span class="kt">%</span><span class="p">;</span>
   <span class="k">background-color</span><span class="p">:</span> <span class="mh">#444</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">chupachups</span> <span class="p">.</span><span class="nc">normal</span> <span class="p">{</span>
   <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ddd</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">chupachups</span> <span class="p">.</span><span class="nc">compensatoria</span> <span class="p">{</span>
   <span class="k">background-color</span><span class="p">:</span> <span class="mh">#7be</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">chupachups</span> <span class="p">.</span><span class="nc">dificil</span> <span class="p">{</span>
   <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ebb</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="last">que provoca que el icono adquiera la forma de un <em>chupachups</em> y en el que se
pretende notar dos características: la cantidad de adjudicaciones (como
contenido del elemento <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code>) y el tipo de centro como color de fondo.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">converter</span></code></dt>
<dd><p class="first">El aspecto del icono depende de los datos asociados, pero es bastante
probable que no dependa de todos, sino sólo de una parte. En nuestro ejemplo,
los datos son:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;adj&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Suprimido&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">],</span>
   <span class="s2">&quot;oferta&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">,</span> <span class="s2">&quot;DAM&quot;</span><span class="p">,</span> <span class="s2">&quot;BACHILLERATO&quot;</span><span class="p">],</span>
   <span class="s2">&quot;tipo&quot;</span><span class="o">:</span> <span class="s2">&quot;normal&quot;</span><span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>o sea, las adjudicaciones, la oferta y el tipo de centro. Sin embargo, el
icono se representa tomando el número de adjudicaciones y el tipo de centro;
la oferta no contribuye al aspecto en obsoluto. Por tanto, las <strong>opciones de
dibujo</strong> deberían ser:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">opts</span> <span class="o">=</span> <span class="p">{</span>
   <span class="nx">numadj</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
   <span class="nx">tipo</span><span class="o">:</span> <span class="s2">&quot;normal&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="dev-map-converter-adj">Para definir cómo transformar <code class="docutils literal notranslate"><span class="pre">data</span></code> en <code class="docutils literal notranslate"><span class="pre">opts</span></code>, la librería provee de una
clase <a class="reference internal" href="02.lib.html#L.utils.Converter" title="L.utils.Converter"><code class="xref js js-class docutils literal notranslate"><span class="pre">L.utils.Converter()</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">converter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Converter</span><span class="p">([</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;tipo&quot;</span><span class="p">])</span>
                     <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="nx">a</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
                     <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Aunque hayamos definido todo en una sola orden, hemos realizado tres tareas:</p>
<ol class="arabic">
<li><p class="first">Crear el objeto:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">converter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Converter</span><span class="p">([</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;tipo&quot;</span><span class="p">]);</span>
</pre></div>
</div>
<p>que permite especificar cuáles son las opciones de dibujo de las que
dependerán los detalles visuales del icono: «<em>numadj</em>» y «»<em>tipo</em>».</p>
</li>
<li><p class="first">Definir cómo obtener <code class="docutils literal notranslate"><span class="pre">numadj</span></code> a partir de los datos:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">converter</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="nx">a</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</pre></div>
</div>
<p>qye significa: para obtener <code class="docutils literal notranslate"><span class="pre">nmumadj</span></code> (primer argumento) debemos
basarnos en el valor de <code class="docutils literal notranslate"><span class="pre">adj</span></code> (segundo argumento) y obtener la longitud
de su valor (que es el significado de la función que se ha usado en tercer
lugar).</p>
</li>
<li><p class="first">Definir cómo obtener <code class="docutils literal notranslate"><span class="pre">tipo</span></code>, para lo cual se ha hecho esta simple
definición:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">converter</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>lo cual es posible, ya que si no especifica el nombre de la propiedad de
los datos, éste coincide con el de la opción de dibujo; y, si no se
especifica la función conversora, el valor no se transforma en absoluto.
Por tanto, lo anterior es equivalente a:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">converter</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">,</span> <span class="s2">&quot;tipo&quot;</span><span class="p">,</span> <span class="nx">t</span> <span class="p">=&gt;</span> <span class="nx">t</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<p>Como el método <a class="reference internal" href="02.lib.html#L.utils.Converter.define" title="L.utils.Converter.define"><code class="xref js js-meth docutils literal notranslate"><span class="pre">L.utils.Converter.define()</span></code></a> devuelve el objeto mismo, es posible hacer
encadenamiento y convertir las tres instrucciones en una sola.</p>
<p>Hay, no obstante, dos puntualizaciones que hacer:</p>
<ol class="arabic">
<li><p class="first">Cuando la opción de dibujo depende de dos o más propiedades, puede usarse
un array. Por ejemplo, supongamos que una opción de dibujo fuera
<code class="docutils literal notranslate"><span class="pre">adjofer</span></code> que es la suma del número de adjudicaciones y el número de
enseñanzas. En ese caso, la definición podría haber sido:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">converter</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;adjofer&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="s2">&quot;oferta&quot;</span><span class="p">],</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</pre></div>
</div>
<p>Téngase en cuenta que los argumentos de la función conversora siguen el
orden definido en el array. Por tanto, <code class="docutils literal notranslate"><span class="pre">a</span></code> representa al array de
adjudicaciones y <code class="docutils literal notranslate"><span class="pre">o</span></code> al de oferta.</p>
</li>
<li><p class="first">Cuando la propiedad está anidada dentro de los datos puede usarse la
notaciión de punto. Por ejemplo, supongamos que la definición de los datos
hubiera sido así:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;adj&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Suprimido&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">],</span>
   <span class="s2">&quot;oferta&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">,</span> <span class="s2">&quot;DAM&quot;</span><span class="p">,</span> <span class="s2">&quot;BACHILLERATO&quot;</span><span class="p">],</span>
   <span class="s2">&quot;mod&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;tipo&quot;</span><span class="o">:</span> <span class="s2">&quot;normal&quot;</span><span class="p">.</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>En ese caso la definición de <code class="docutils literal notranslate"><span class="pre">tipo</span></code> podría haberse hecho del siguiente
modo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">converter</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">,</span> <span class="s2">&quot;mod.tipo&quot;</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<div class="last admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Si se desean aplicar correcciones sobre los datos, los valores
de las propiedaes que son arrays susceptibles de sufrir correcciones,
deben consultarse teniéndolo en cuenta. Vea más adelante <a class="reference internal" href="#dev-map-correctable"><span class="std std-ref">cómo
hacerlo</span></a>.</p>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">updater</span></code></dt>
<dd><p class="first">Define la función que traslada los valores de las opciones de dibujo al
dibujo en sí:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">updater</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.content&quot;</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">tipo</span><span class="p">)</span> <span class="nx">content</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;content &quot;</span> <span class="o">+</span> <span class="nx">o</span><span class="p">.</span><span class="nx">tipo</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">numadj</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="nx">content</span><span class="p">.</span><span class="nx">firstElementChild</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">numadj</span><span class="p">;</span>
   <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El contexto de la función es el elemento <abbr title="HyperText Markup Language">HTML</abbr> que representa al icono en la
página<a class="footnote-reference" href="#id13" id="id4">[4]</a>, y <code class="docutils literal notranslate"><span class="pre">o</span></code> es el objeto que contiene las opciones de dibujo.</p>
<div class="last admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Para la mejora del rendimiento, no se pasan todos los parámetros
sino sólo aquellos que han cambiado desde la última vez que se dibujó el
icono. Por ese motivo, debe definir la función teniendo en cuenta esto.
En la función de ejemplo, si no se pasa el <em>tipo</em>, no se modifica la clase
de «<em>content</em>», y si no se pasa <em>numadj</em>, no se modifica el número
contenido en el elemento <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code>. Esto es así, porque no pasar la
opción significa que su valor no ha cambiado y, en consecuencia, ese
aspecto del dibujo debe permanecer igual.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="definicion">
<h4>3.1.2.3.2. Definición<a class="headerlink" href="#definicion" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Con todos los ingredientes anteriores, podemos definir un estilo para el icono:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">crearIcono</span><span class="p">()</span> <span class="p">{</span>
   <span class="c1">// Definiciones de html, css, converter, updater, fast.</span>

   <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">createMutableIconClass</span><span class="p">(</span><span class="s2">&quot;chupachups&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">iconSize</span><span class="o">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>
      <span class="nx">iconAnchor</span><span class="o">:</span> <span class="p">[</span><span class="mf">12.5</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>
      <span class="nx">css</span><span class="o">:</span> <span class="nx">css</span><span class="p">,</span>
      <span class="nx">html</span><span class="o">:</span> <span class="nx">html</span><span class="p">,</span>
      <span class="nx">converter</span><span class="o">:</span> <span class="nx">converter</span><span class="p">,</span>
      <span class="nx">updater</span><span class="o">:</span> <span class="nx">updater</span>
   <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Por supuesto, podemos seguir añadiendo opciones definidas para la
clase <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#icon">L.Icon</a> como es el
caso de <code class="docutils literal notranslate"><span class="pre">className</span></code>, <code class="docutils literal notranslate"><span class="pre">iconSize</span></code> o <code class="docutils literal notranslate"><span class="pre">iconAnchor</span></code>. En el caso de esta primera
opción no se ha definido valor alguno, pero cuando eso ocurre, la función
añade un nombre de clase igual al del nombre que se le da al icono («<em>chupachups</em>»),
de ahí que en el <abbr title="Cascading Style Sheets">CSS</abbr> que definía la forma del icono, se hubiera usado la
clase «<em>chupachups</em>».</p>
</div>
</div>
</div>
<div class="section" id="acceso-a-marcas">
<h3>3.1.2.4. Acceso a marcas<a class="headerlink" href="#acceso-a-marcas" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La inserción de los datos en la capa, genera para cada uno de ellos la marca que
definimos en el método <code class="docutils literal notranslate"><span class="pre">.pointToLayer()</span></code>. Ahora bien, ¿qué mecanismos tenemos
para acceder a estas marcas?</p>
<ul>
<li><p class="first">La clase <code class="docutils literal notranslate"><span class="pre">Centro</span></code> dispone de un atributo <a class="reference internal" href="02.lib.html#Marker.store" title="Marker.store"><code class="xref js js-attr docutils literal notranslate"><span class="pre">store</span></code></a>, que es un <em>array</em>
compuesto por todas las marcas que se han creado de esa clase:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span><span class="kr">const</span> <span class="nx">c</span> <span class="k">in</span> <span class="nx">Centro</span><span class="p">.</span><span class="nx">store</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Hola, soy una marca de centro&quot;</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p><code class="docutils literal notranslate"><span class="pre">Centro</span></code> es el constructor de una marca de centro, en
consecuencia, dada una marca llamada <code class="docutils literal notranslate"><span class="pre">centro</span></code>:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">centro</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">===</span> <span class="nx">Centro</span>
</pre></div>
</div>
</div>
<ul>
<li><p class="first">Podemos acceder a las marcas a través de eventos, exactamente como a cualquier
marca de <a class="reference external" href="https://leafletjs.com/">Leaflet</a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">centro</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Soy la marca que acabas de pulsar&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">));</span>
</pre></div>
</div>
<p>Las marcas mutables, además, tienen definido un tipo «<em>dataset</em>» que se desencadena cuando
se asocian los datos a la marca.</p>
</li>
<li><p class="first">Como atajo, cuando se quiere aplicar un método a todas las marcas de la clase,
puede usar el método de clase <a class="reference internal" href="02.lib.html#Marker.invoke" title="Marker.invoke"><code class="xref js js-meth docutils literal notranslate"><span class="pre">Marker.invoke()</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Soy la marca que acabas de pulsar&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">));</span>
<span class="nx">Centro</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Justamente ahora me acaba de asociar unos datos&quot;</span><span class="p">));</span>
</pre></div>
</div>
</li>
<li><p class="first">Tenga presente que cuando añade una marca a una capa cuya clase derive de
<a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#featuregroup">L.FeatureGroup</a>, como <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#geojson">L.GeoJSON</a> o <a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">L.MarkerClusterGroup</a>, se dispara el evento
<em>layeradd</em>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">layer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;layeradd&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Acabo de ser añadida&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
<p class="rubric" id="dev-map-ejmin">Ejemplo de aplicación</p>
<p>Con lo expuesto hasta ahora, seríamos capaces de construir un mapa con marcas
que ajusten su aspecto al valor de sus datos, esto es, que son capaces de
realizar <a class="reference internal" href="#dev-map-util"><span class="std std-ref">el primer punto con que expusimos la utilidad</span></a> de
la librería:</p>
<ul class="simple">
<li>Consulte <a class="reference external" href="https://sio2sio2.github.io/lobaton/docs/examples/demo.minima.html">en línea el resultado del ejemplo</a>.</li>
</ul>
</div>
<div class="section" id="correcciones">
<h3>3.1.2.5. Correcciones<a class="headerlink" href="#correcciones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El <em class="dfn">sistema de correcciones</em> permite alterar los datos iniciales de las
marcas según una serie de criterios establecidos por el usuario al interaccionar
con la interfaz visual. En el ejemplo anterior, podríamos desear «<em>eliminar
todas las adjudicaciones que sean de un colectivo determinado</em>». Si el colectivo
fuese el de <em>interinos</em>, es claro que las adjudicaciones pasarían de <strong>4</strong> a
<strong>3</strong> y de <strong>3</strong> a <strong>2</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Las correcciones pueden aplicarse, exclusivamente, sobre atrbutos
cuyo valor sea un <em>array</em>.</p>
</div>
<p>Hay dos tipos diferentes de correcciones:</p>
<ol class="loweralpha simple">
<li>Las correcciones que eliminan elementos del <em>array</em>. como es el caso de la
corrección de ejemplo que se acaba de enunciar.</li>
<li>Las correcciones que añaden elementos al <em>array</em>.</li>
</ol>
<div class="section" id="id5">
<h4>3.1.2.5.1. Definición<a class="headerlink" href="#id5" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Para definir los criterios de corrección es preciso registrar cada criterio
sobre la clase de la marca:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span>
   <span class="c1">// opts = {colectivo: [&quot;Interino&quot;]}</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">adj</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">inv</span> <span class="o">^</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">colectivo</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">adj</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Una corrección sólo puede aplicarse a una única propiedad.</p>
</div>
<p>El código crea un corrección de nombre «<em>adjcol</em>» que se aplica sobre la
propiedad de los datos <code class="docutils literal notranslate"><span class="pre">adj</span></code>. Como es una corrección que pretende eliminar
elementos, se ejecutará la función suministrada por <code class="docutils literal notranslate"><span class="pre">func</span></code> para cada uno de
los elementos del <em>array</em> <code class="docutils literal notranslate"><span class="pre">adj</span></code>, de manera que cuando devuelva <code class="docutils literal notranslate"><span class="pre">true</span></code> se
eliminará el elemento y cuando devuelva <code class="docutils literal notranslate"><span class="pre">false</span></code>, se conservará. Tal como está
escrita la función, se desecharán las adjudicaciones a colectivos que se
encuentren en la lista suministrada a través de las opciones. Además se incluye
un atributo <em>inv</em> para poder invertir el significado.</p>
<p>La función usa como contexto la marca sobre la que opera la corrección
y tiene tres argumentos:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">idx</span></code></dt>
<dd>El índice correspondiente al valor que comprueba la función.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">adj</span></code></dt>
<dd>que es el array completo. En el ejemplo, el array <code class="docutils literal notranslate"><span class="pre">adj</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">opts</span></code></dt>
<dd>que es un objeto que contiene las opciones que permiten determinar la
corrección y cuya obtención será tarea de la interfaz de usuario. Para la
definición de ejemplo, se necesitan los colectivos cuya adjudicación deseamos
conservar (propiedad <code class="docutils literal notranslate"><span class="pre">colectivo</span></code>) y una propiedad <code class="docutils literal notranslate"><span class="pre">inv</span></code> que sirve para
invertir el significado.</dd>
</dl>
<p>En caso de que la corrección sirva para añadir elementos, es necesario añadir la
propiedad <code class="docutils literal notranslate"><span class="pre">add</span></code> con valor <code class="docutils literal notranslate"><span class="pre">true</span></code> en la definición, y durante la aplicación
no se recorrerá el array elemento por elemento, sino que la función se ejecutará
una vez y deberá devolver un <em>array</em> con los elementos que se desean incorporar.
Como <code class="docutils literal notranslate"><span class="pre">idx</span></code> no tiene sentido en este caso, tomará el valor de <em>null</em>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;vt+&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span>
   <span class="nx">add</span><span class="o">:</span> <span class="kc">true</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">adj</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getData</span><span class="p">();</span>
      <span class="c1">// Como nuestros datos son muy simples y no hay información alguna,</span>
      <span class="c1">// nos inventamos que en todos ha habido dos vacantes telefónicas</span>
      <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;Interino&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">];</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Aunque tenga disponible el <em>array</em> dentro de la función, no añada
los nuevos elementos; limítese a devolverlos.</p>
</div>
</div>
<div class="section" id="aplicacion">
<h4>3.1.2.5.2. Aplicación<a class="headerlink" href="#aplicacion" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El registro de una corrección no provoca ningún cambio en los datos: sólo la
define. Para llevar a efecto la corrección es necesario aplicar la corrección:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">ccrrect</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">colectivo</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Prácticas&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">]});</span>
</pre></div>
</div>
<p>que sutirá efecto en todas las marcas de la clase <code class="docutils literal notranslate"><span class="pre">Centro</span></code>. En este caso, en
todas estas márcas  se <em>eliminará</em> del array de adjudicaciones (o sea, <code class="docutils literal notranslate"><span class="pre">adj</span></code>),
los elementos que no representan adjudicaciones a personal en prácticas o
interino.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p>La aplicación de la corrección no altera automáticamente el aspecto
de las marcas. Para hacerlo, debe aplicarse el método <a class="reference internal" href="02.lib.html#Marker.refresh" title="Marker.refresh"><code class="xref js js-class docutils literal notranslate"><span class="pre">Marker.refresh()</span></code></a> sobre
las marcas:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s2">&quot;refresh&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si con posterioridad a la aplicación, se crea una nueva marca de tipo
<code class="docutils literal notranslate"><span class="pre">Centro</span></code>, las correcciones aplicadas a la clase, se aplicarán sobre a la marca
en cuanto se conecten a ella los datos.</p>
</div>
<p id="dev-map-correctable">Se ha afirmado alegremente que se eliminan elementos del <em>array</em>, pero no es
cierto, puesto que si se eliminaran sin más no podría revertirse la corrección.
En realidad, todos los elementos siguen ahí, e incluso pueden haber aparecido
nuevos si hubo correcciones que los añadieron. Para consultar un <em>array</em> con
correcciones debe tenerse en cuenta lo siguiente</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">.length</span></code></dt>
<dd>Devuelve la cantidad total de elementos: los preexistentes y los añadidos,
se hayan eliminado o no. En general, todas las funciones que se aplican al
<em>array</em> elemento por elemento (<a class="reference external" href="https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Objetos_globales/Array/forEach">.forEach()</a>, <a class="reference external" href="https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Objetos_globales/Array/map">.map()</a>, etc.) actúan de
esta forma. En consecuenta, recorrerán todos los elementos, pero no se podrá
conocer de ellos si está eliminado o no.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">..</span> <span class="pre">of</span></code></dt>
<dd><p class="first">Devuelve también todos los elementos, eliminados o no, pero cada elemento no
es el elemento original, sino un nuevo objeto que se caracteriza por lo
siguiente:</p>
<ul class="simple">
<li>Si el elemento original era un objeto, devuelve un objeto con las mismas
propiedades al que se ha añadido otra llamada <code class="docutils literal notranslate"><span class="pre">filters</span></code> que es un <em>array</em>
con los nombres de las correcciones que filtran el valor. EN consecuencia,
un <code class="docutils literal notranslate"><span class="pre">filters</span></code> vacío supone que el valor no se ha filtrado.</li>
<li>Si el elemento original no era un objeto, sino un tipo primitivo, se
devuelve un objeto en cuyo atributo <code class="docutils literal notranslate"><span class="pre">value</span></code> se almacena el valor
original del elemento. También dispone del atributo <code class="docutils literal notranslate"><span class="pre">filters</span></code>.</li>
</ul>
<p class="last">En ambos casos se dispone de un método <code class="docutils literal notranslate"><span class="pre">isPrimitive</span></code> para saber si el
elemento original era o no un objeto en su origen.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.total</span></code></dt>
<dd><p class="first">Devuelve el número total de elementos, descontados los eliminados. Por tanto,
la <a class="reference internal" href="#dev-map-converter-adj"><span class="std std-ref">conversión de adj en numadj</span></a> debimos haberla
hecho así:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">converter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Converter</span><span class="p">([</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;tipo&quot;</span><span class="p">])</span>
                        <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="nx">a</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">);</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="reversion">
<h4>3.1.2.5.3. Reversión<a class="headerlink" href="#reversion" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Para revertir una corrección, basta con pasar su nombre:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">uncorrect</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p>Tampoco en este caso se refresca el aspecto de las marcas. Por
tanto,  si quiere trasladar el cambio al aspecto de los iconos:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s2">&quot;refresh&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="encadenamiento">
<h4>3.1.2.5.4. Encadenamiento<a class="headerlink" href="#encadenamiento" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En algunos casos, podría darse la circunstancia de que la aplicación de una
corrección sobre una propiedad supusiera la aplicación automática de la
aplicación de otra corrección. Un ejemplo real podría ser el siguiente: si sólo
nos interesan enseñanzas bilingües (corrección sobre la oferta educativa),
entonces sólo nos deberían interesar las adjudicaciones a puestos bilingües
(corrección sobre las adjucaciones).  Como, desgraciadamente, no podemos llevar
a la práctica este ejemplo al estar utilizando una versión muy simplificada de
los datos, implementaremos un encadenamiento absurdo, pero que sirve para
ilustrar cómo se hace: <em>si nos interesan sólo puestos interinos, entonces no nos
interesa la enseñanza DAM</em>.</p>
<p>Sin encadenamiento, la definición de nuestras correcciones sería así:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">adj</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">inv</span> <span class="o">^</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">colectivo</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">adj</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
   <span class="p">}</span>
<span class="p">})</span>
      <span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;oferta&quot;</span><span class="p">,</span>
   <span class="c1">// opts = {ens: [&quot;DAM&quot;] }</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">oferta</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">ens</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">oferta</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Como vemos, hemos definido la corrección «<em>of</em>» para que se desechen las
enseñanzas que coincidan con alguna de las que pasemos a través de las opciones.
Para el encadenamiento que queremos, podemos hacer la siguiente definición:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">adj</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">inv</span> <span class="o">^</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">colectivo</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">adj</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
   <span class="p">},</span>
<span class="hll">   <span class="nx">autochain</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="hll">   <span class="nx">chain</span><span class="o">:</span> <span class="p">[</span>
</span><span class="hll">      <span class="p">{</span>
</span><span class="hll">         <span class="nx">corr</span><span class="o">:</span> <span class="s2">&quot;of&quot;</span><span class="p">,</span>
</span><span class="hll">         <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="k">if</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">colectivo</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">colectivo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;Interino&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">               <span class="k">return</span> <span class="p">{</span><span class="nx">ens</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;DAM&quot;</span><span class="p">]}</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class="hll">         <span class="p">}</span>
</span><span class="hll">      <span class="p">}</span>
</span><span class="hll">   <span class="p">]</span>
</span><span class="p">})</span>
     <span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="p">{</span>  <span class="c1">// Esto no cambia en absoluto.</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;oferta&quot;</span><span class="p">,</span>
   <span class="c1">// opts = {ens: [&quot;DAM&quot;] }</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">oferta</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">ens</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">oferta</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>O sea:</p>
<ul class="simple">
<li>Definimos una cadena de correcciones para <em>adjcol</em> a través del atributo
<code class="docutils literal notranslate"><span class="pre">chain</span></code>. El encadenamiento sólo define que podrá lanzarse automáticamente
la corrección <em>of</em>.</li>
<li>El atributo <code class="docutils literal notranslate"><span class="pre">autochain</span></code> permite definir si queremos que el encadenamiento
se lleve a cabo al aplicar la corrección (<code class="docutils literal notranslate"><span class="pre">true</span></code>) o si esta decisión se
se pospone hasta ese momento.</li>
<li>Se debe definir una función que transforme las opciones de <em>adjcol</em> en
opciones de <em>of</em>. El contexto de esta función es el tipo de marca (<code class="docutils literal notranslate"><span class="pre">Centro</span></code>
en el ejemplo).</li>
<li>Si los valores de las opciones de <em>adjcol</em>, no provocan ningún efecto, entones
la función de transformación debe devolver <code class="docutils literal notranslate"><span class="pre">false</span></code>.</li>
</ul>
<p>Además al aplicar las correcciones, podemos incluir un argumento adicional que
sobreescribe el valor de <code class="docutils literal notranslate"><span class="pre">autochain</span></code>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">ccrrect</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">colectivo</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Interino&quot;</span><span class="p">]},</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
<p>en este caso se llevara a cabo el encadenamiento, a pesar de haber indicado
<code class="docutils literal notranslate"><span class="pre">false</span></code> antes.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Internamiente no se aplica una corrección <em>of</em>, sino un corrección
«<em>adjcol of</em>», por lo que podemos aplicar de forma independiente una
corrección <em>of</em>:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">correct</span><span class="p">(</span><span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">ens</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">]})</span>
</pre></div>
</div>
</div>
<p>Si se desea conocer para una corrección qué otras correcciones la han aplicado
automáticamente y con qué opciones, puede usarse el método
<a class="reference internal" href="02.lib.html#Marker.getAutoCorrect" title="Marker.getAutoCorrect"><code class="xref js js-meth docutils literal notranslate"><span class="pre">Marker.getAutoCorrect()</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">getAutoCorrect</span><span class="p">(</span><span class="s2">&quot;of&quot;</span><span class="p">);</span>  <span class="c1">// {adjcol: {ens: [&quot;DAM&quot;]}}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="filtros">
<h3>3.1.2.6. Filtros<a class="headerlink" href="#filtros" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El <em class="dfn">sistema de filtros</em> posibilita eliminar entidades que cumplan con los
criterios que establezcamos. Para habilitar el sistema de filtros es necesario
añadir la opción <code class="docutils literal notranslate"><span class="pre">filter</span></code> al crear la clase de marca:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Marker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;feature.properties&quot;</span><span class="p">,</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="nx">layer</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>En principio, le daremos como valor a <code class="docutils literal notranslate"><span class="pre">fitler</span></code> la capa en la que se insertarán
las marcas (que habíamos llamado <code class="docutils literal notranslate"><span class="pre">layer</span></code>), aunque pueden facilitarse otros
valores (véase <a class="reference internal" href="#dev-map-style-filter"><span class="std std-ref">estilos de filtros</span></a>). Obrando así,
el efecto del filtrado es que desaparecerán totalmente del mapa las marcas
filtradas.</p>
<div class="section" id="id6">
<h4>3.1.2.6.1. Definición<a class="headerlink" href="#id6" title="Enlazar permanentemente con este título">¶</a></h4>
<p>De manera análoga a como se obra con las correcciones, antes de poder aplicar
filtros es necesario registrarlos. Este sería el filtro para filtrar cectros
que tengan menos de un número mínimo de adjudicaciones:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">registerF</span><span class="p">(</span><span class="s2">&quot;adjmin&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attrs</span><span class="o">:</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getData</span><span class="p">().</span><span class="nx">adj</span><span class="p">.</span><span class="nx">total</span> <span class="o">&lt;</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">min</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Para el registro del filtro es necesario un nombre (<em>adj</em> en el código de
ejemplo) y un objeto con dos propiedades:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">attrs</span></code></dt>
<dd>Es la lista de propiedades de los datos involucradas en el cálculo. Debe ser
un <em>array</em>, pero si es una propiedad sola, podemos ahorramos el <em>array</em> y
escribir directamente el nombre de la propiedad.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">func</span></code></dt>
<dd>Función que define si el centro se filtra (devuelve <code class="docutils literal notranslate"><span class="pre">true</span></code>) o no (devuelve
<code class="docutils literal notranslate"><span class="pre">false</span></code>). Su contexto es la propia marca que se desea comprobar.</dd>
</dl>
</div>
<div class="section" id="id7">
<h4>3.1.2.6.2. Aplicación<a class="headerlink" href="#id7" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Para aplicar un filtro registrado, basta con pasar su nombre y cuáles son las
opciones de filtro. En el caso de ejemplo, si quisiéramos eliminar los centros
sin adjudicaciones, deberíamos aplicar el filtro «<em>adj</em>» del siguiente modo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;adjmin&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">min</span><span class="o">:</span> <span class="mi">1</span><span class="p">});</span>
</pre></div>
</div>
<p>La aplicación del filtro afecta a las marcas que en ese momento se hayan creado,
afectará a las futuras y se recalculará cada vez que se aplique una corrección
que modifique alguna de las propiedades que listamos en <code class="docutils literal notranslate"><span class="pre">attrs</span></code>. Ahora bien,
como en el caso de las correcciones, los cambios sólo se trasladarán al dibujo
cuando refresquemos las marcas:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s2">&quot;refresh&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h4>3.1.2.6.3. Reversión<a class="headerlink" href="#id8" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Para eliminar un filtro, basto con su nombre:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">unfilter</span><span class="p">(</span><span class="s2">&quot;adjmin&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>aunque deberemos refrescar para trasladar el efecto del filtro al dibujo.</p>
</div>
<div class="section" id="estilos">
<span id="dev-map-style-filter"></span><h4>3.1.2.6.4. Estilos<a class="headerlink" href="#estilos" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Hasta el momento, el comportamiento de las marcas filtradas es desaparecer del
mapa y esto es debido a que dimos a la opción <code class="docutils literal notranslate"><span class="pre">filter</span></code> como valor la capa en
la que se agregan las marcas. Sin embargo, existe la alternativa de no hacer
desaparecer la marca, sino cambiar su aspecto para notar que está filtrada. para
ello podemos usar dos valores alternativos para la opción:</p>
<ul>
<li><p class="first">Un nombre, que hará que el elemento <abbr title="HyperText Markup Language">HTML</abbr> que representa la marca
filtrada se incluya en la clase <abbr title="Cascading Style Sheets">CSS</abbr> de tal nombre:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Marker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;feature.properties&quot;</span><span class="p">,</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="s2">&quot;filtrado&quot;</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Y en el <abbr title="Cascading Style Sheets">CSS</abbr>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nx">filtrado</span> <span class="p">{</span>
   <span class="nx">filter</span><span class="o">:</span> <span class="nx">grayscale</span><span class="p">(</span><span class="mi">100</span><span class="o">%</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El efecto es que las marcas filtradas aparecerán en gris, y no en color.</p>
</li>
<li><p class="first">Una función que toma como contexto el elemento <abbr title="HyperText Markup Language">HTML</abbr> y lo modifica a
voluntad:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Marker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;feature.properties&quot;</span><span class="p">,</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filtered</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span><span class="p">(</span><span class="nx">filtered</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="s2">&quot;grayscale(100%)&quot;</span><span class="p">;</span>
         <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="s2">&quot;filter&quot;</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><p>que tiene el mismo efecto que el código anterior. En concreto, para este
efecto, la librería ya tiene definida una función que puede usarse
directamente:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Marker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;feature.properties&quot;</span><span class="p">,</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">grayFilter</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div></blockquote>
<p>Una vez definida la clase, es posible modificar el estilo posteriormente:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">setFilter</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">grayFilter</span><span class="p">);</span>
</pre></div>
</div>
<p>En este caso, a diferencia de cuando se aplican filtros y correcciones, el
redibujado de marca se hace automáticamente.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Cuando el estilo de filtro no elimina las marcas del mapa y se usa
una capa <a class="reference internal" href="#dev-map-cluster"><span class="std std-ref">MarkerClusterGroup</span></a>, el número del cluster
incluirá las marcas filtradas, ya que estas siguen en el mapa. Para evitarlo
y que sólo represente las marcas no filtradas puede cambiarse la función que
crea los iconos para los clusters y pasarla a través de la función
<code class="docutils literal notranslate"><span class="pre">iconCreateFunction</span></code>. La librería trae ya una hecha con este fin:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">markerClusterGroup</span><span class="p">({</span>
   <span class="nx">iconFunctionCreate</span><span class="o">:</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">noFilteredIconCluster</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p class="rubric">Ejemplo de aplicación</p>
<ul class="simple">
<li>Consulte <a class="reference external" href="https://sio2sio2.github.io/lobaton/docs/examples/demo.corr.html">en línea la variante del ejemplo anterior que añade una
corrección y un filtro</a></li>
</ul>
</div>
</div>
</div>
<div class="section" id="variantes">
<h2>3.1.3. Variantes<a class="headerlink" href="#variantes" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Planteamos bajo este epígrafe algunas variantes intersantes sobre el uso ya
ilustrado.</p>
<div class="section" id="leaflet-markercluster">
<span id="dev-map-cluster"></span><h3>3.1.3.1. <a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">Leaflet.markercluster</a><a class="headerlink" href="#leaflet-markercluster" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando las marcas son numerosas, es indispensable usar esta extensión que
permite agrupar marcas cercanas e irlas desglosando según ampliamos la escala.
<code class="file docutils literal notranslate"><span class="pre">leafext.js</span></code> es compatible con una capa <a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">L.MarkerClusterGroup</a>, aunque
convendría tener claro cómo manejar datos en formato <a class="reference external" href="http://geojson.org/">GeoJSON</a> con ella. Lo más
sencillo es usar una capa <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#geojson">L.GeoJSON</a> intermedia, que se encargue de interpretar
los datos:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">markerClusterGroup</span><span class="p">({</span>
   <span class="nx">showCoverageOnHover</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
   <span class="c1">// Al llegar a nivel 14 de zoom se ven todas las marcas.</span>
   <span class="nx">disableClusteringAtZoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
   <span class="nx">spiderfyOnMaxZoom</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="c1">// Obsérvese que no la añadimos al mapa.</span>
<span class="kr">const</span> <span class="nx">interm</span> <span class="o">=</span>  <span class="nx">L</span><span class="p">.</span><span class="nx">geoJSON</span><span class="p">(</span><span class="nx">datos</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">pointToLayer</span><span class="o">:</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nx">Centro</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">icon</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Icono</span><span class="p">(),</span>
      <span class="nx">title</span><span class="o">:</span> <span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span>
   <span class="p">})</span>
<span class="p">});</span>

<span class="c1">//Pasamos las marcas individuales a la capa de clústers</span>
<span class="nx">layer</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">interm</span><span class="p">);</span>

<span class="nx">interm</span><span class="p">.</span><span class="nx">clearLayers</span><span class="p">();</span>
</pre></div>
</div>
<p>Tenga presente que la marca intermedia no se añade a la capa
<a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">L.MarkerClusterGroup</a>,
sino las marcas individuales que se encuentran en ella. Por ese motivo, una vez
pasadas las marcas, eliminamos las marcas de la capa <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#geojson">L.GeoJSON</a> para poder
seguir utilizándola como intermediaria.</p>
<p>Obsérvese que utilizando el código susodicho, se construyen todas las marcas
mientras se introducen en la capa intermedia y, ya creadas todas, se añaden del
tirón a la capa final. Una variante, quizás más interesante, es añadirlas a la
capa final, según las van creando la intermedia:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">markerClusterGroup</span><span class="p">({</span>
   <span class="nx">showCoverageOnHover</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
   <span class="c1">// Al llegar a nivel 14 de zoom se ven todas las marcas.</span>
   <span class="nx">disableClusteringAtZoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
   <span class="nx">spiderfyOnMaxZoom</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="c1">// Obsérvese que no la añadimos al mapa.</span>
<span class="kr">const</span> <span class="nx">interm</span> <span class="o">=</span>  <span class="nx">L</span><span class="p">.</span><span class="nx">geoJSON</span><span class="p">(</span><span class="nx">datos</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">pointToLayer</span><span class="o">:</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nx">Centro</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">icon</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Icono</span><span class="p">(),</span>
      <span class="nx">title</span><span class="o">:</span> <span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span>
   <span class="p">}),</span>
   <span class="nx">onEachFeature</span><span class="o">:</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">interm</span><span class="p">.</span><span class="nx">clearLayers</span><span class="p">();</span>
</pre></div>
</div>
<p>La ventaja de este código sobre el anterior es que cada vez que creamos y
añadimos de modo efectivo una marca al mapa (o sea a la capa
<a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">L.MarkerClusterGroup</a>)
podemos lanzar un disparador con:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">layer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;layeradd&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Creado y añadido el centro </span><span class="si">${</span><span class="nx">e</span><span class="p">.</span><span class="nx">layer</span><span class="p">,</span><span class="nx">getData</span><span class="p">().</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">));</span>
</pre></div>
</div>
<p>Con el primer codigo, en cambio, las marcas se creaban todas antes de añadirse
la primera al mapa.</p>
</div>
<div class="section" id="datos-que-no-son-geojson">
<span id="dev-map-no-geojson"></span><h3>3.1.3.2. Datos que no son <a class="reference external" href="http://geojson.org/">GeoJSON</a><a class="headerlink" href="#datos-que-no-son-geojson" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando los datos no están en formato <a class="reference external" href="http://geojson.org/">GeoJSON</a>, la capa <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#geojson">L.GeoJSON</a> nos sirve de
poco y debemos de ser nosotros los que creemos la marca y añadamos a ella los
datos. Supongamos que los datos son estos:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;centros&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Centro 1&quot;</span><span class="p">,</span>
         <span class="nt">&quot;lng&quot;</span><span class="p">:</span> <span class="mf">-5.9526</span><span class="p">,</span>
         <span class="nt">&quot;lat&quot;</span><span class="p">:</span> <span class="mf">37.275475</span><span class="p">,</span>
         <span class="nt">&quot;adj&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Suprimido&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">],</span>
         <span class="nt">&quot;oferta&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">,</span> <span class="s2">&quot;DAM&quot;</span><span class="p">,</span> <span class="s2">&quot;BACHILLERATO&quot;</span><span class="p">],</span>
         <span class="nt">&quot;tipo&quot;</span><span class="p">:</span> <span class="s2">&quot;normal&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Centro 2&quot;</span><span class="p">,</span>
         <span class="nt">&quot;lng&quot;</span><span class="p">:</span> <span class="mf">-4.6389</span><span class="p">,</span>
         <span class="nt">&quot;lat&quot;</span><span class="p">:</span> <span class="mf">37.58434</span><span class="p">,</span>
         <span class="nt">&quot;adj&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Expectativa&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">],</span>
         <span class="nt">&quot;oferta&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">,</span> <span class="s2">&quot;ASIR&quot;</span><span class="p">],</span>
         <span class="nt">&quot;tipo&quot;</span><span class="p">:</span> <span class="s2">&quot;dificil&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>o sea, los mismos datos de antes, pero sin el formato <a class="reference external" href="http://geojson.org/">GeoJSON</a>. En ese caso,
podríamos escribir un función que para cada centro creara su marca
correspondiente y la añadiera a la capa:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Icono</span> <span class="o">=</span> <span class="nx">crearIcono</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Marker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span><span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;data&quot;</span><span class="p">}</span>
<span class="p">});</span>

<span class="nx">map</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="s2">&quot;map&quot;</span><span class="p">).</span><span class="nx">setView</span><span class="p">([</span><span class="mf">37.07</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.27</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">tileLayer</span><span class="p">(</span><span class="s1">&#39;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">18</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">featureGroup</span><span class="p">();</span>  <span class="c1">// También podria ser L.markerCluster.</span>

<span class="nx">funcion</span> <span class="nx">CrearMarca</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Centro</span><span class="p">([</span><span class="nx">d</span><span class="p">.</span><span class="nx">lat</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">lng</span><span class="p">]{</span>
      <span class="nx">icon</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Icon</span><span class="p">();</span>
      <span class="nx">title</span><span class="o">:</span> <span class="nx">d</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
   <span class="p">});</span>
   <span class="k">delete</span> <span class="nx">d</span><span class="p">.</span><span class="nx">lat</span><span class="p">;</span>
   <span class="k">delete</span> <span class="nx">d</span><span class="p">.</span><span class="nx">lng</span><span class="p">;</span>
   <span class="nx">m</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span>  <span class="c1">// En consonancia con el valor de mutable.</span>

   <span class="k">return</span> <span class="nx">m</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">for</span><span class="p">(</span><span class="kr">const</span> <span class="nx">d</span> <span class="k">of</span> <span class="nx">datos</span><span class="p">)</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">crearMarca</span><span class="p">(</span><span class="nx">d</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="barra-de-progreso">
<h3>3.1.3.3. Barra de progreso<a class="headerlink" href="#barra-de-progreso" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Por hacer</p>
<p class="last">Corregir esto, porque se queda suspendido el navegador hasta ue acaba
la carga.</p>
</div>
<p>Los ejemplos que acompañan a <a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">Leaflet.Markercluster</a> incluyen <a class="reference external" href="http://leaflet.github.io/Leaflet.markercluster/example/marker-clustering-realworld.50000.html">alguno con una
sencilla barra de progreso</a>
que informa de cómo va el procesamiento de datos y su adición al mapa en forma
de marca<a class="footnote-reference" href="#id14" id="id9">[5]</a>. Se basa en la las opciones <code class="docutils literal notranslate"><span class="pre">chuckedLoading</span></code> y
<code class="docutils literal notranslate"><span class="pre">chuckProgress</span></code> de <a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">L.MarkerClusterGroup</a>, que son útiles cuando se añaden de una
sola vez muchos datos a la capa, como es el caso del primer ejemplo incluido en
el <a class="reference internal" href="#dev-map-cluster"><span class="std std-ref">apartado dedicado a discutir sobre este tipo de capa</span></a>. Sin embargo, si usamos otro tipo de capa o si utilizamos
ésta, pero añadiendo una a una las marcas., tal solución se vuelve
impracticable. Con todo, podemos construirnos nuestra propia solución con ayuda
del evento <em>layeradd</em>. Necesitamos un <abbr title="HyperText Markup Language">HTML</abbr> como este:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;progress&quot;</span><span class="p">&gt;&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;progress-bar&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Un <abbr title="Cascading Style Sheets">CSS</abbr> para la barra que tomamos del ejemplo original:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">#</span><span class="nn">progress</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">z-index</span><span class="p">:</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="k">top</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">50</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">10</span><span class="kt">px</span><span class="p">);</span>
    <span class="k">left</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">50</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">100</span><span class="kt">px</span><span class="p">);</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">margin-top</span><span class="p">:</span> <span class="mi">-20</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">-100</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#fff</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">);</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">#</span><span class="nn">progress-bar</span> <span class="p">{</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#76A6FC</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Y añadir algo de <em>javascript</em> a las soluciones anteriores:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">markerClusterGroup</span><span class="p">({</span>
   <span class="nx">showCoverageOnHover</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
   <span class="c1">// Al llegar a nivel 14 de zoom se ven todas las marcas.</span>
   <span class="nx">disableClusteringAtZoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
   <span class="nx">spiderfyOnMaxZoom</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="c1">// Barra de progreso.</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">progress</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">),</span>
         <span class="nx">progressBar</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;progress-bar&#39;</span><span class="p">),</span>
         <span class="nx">total</span> <span class="o">=</span> <span class="nx">datos</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
         <span class="nx">incr</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>      <span class="c1">// Cada qué % se actualiza la barra.</span>

   <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="nx">progressBar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span><span class="p">;</span>

   <span class="kr">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
         <span class="nx">step</span>  <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">total</span><span class="o">/</span><span class="mi">100</span><span class="o">/</span><span class="nx">incr</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>

   <span class="kd">function</span> <span class="nx">progressB</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">%</span><span class="nx">step</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">progress</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&quot;block&quot;</span><span class="p">;</span>
         <span class="nx">progressBar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="nx">total</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="nx">total</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">progress</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">;</span>
         <span class="nx">layer</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">&quot;layeradd&quot;</span><span class="p">,</span> <span class="nx">progressB</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="nx">layer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;layeradd&quot;</span><span class="p">,</span> <span class="nx">progressB</span><span class="p">);</span>
<span class="p">})();</span>

<span class="kr">const</span> <span class="nx">interm</span> <span class="o">=</span>  <span class="nx">L</span><span class="p">.</span><span class="nx">geoJSON</span><span class="p">(</span><span class="nx">datos</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">pointToLayer</span><span class="o">:</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nx">Centro</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">icon</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Icono</span><span class="p">(),</span>
      <span class="nx">title</span><span class="o">:</span> <span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span>
   <span class="p">}),</span>
   <span class="nx">onEachFeature</span><span class="o">:</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">interm</span><span class="p">.</span><span class="nx">clearLayers</span><span class="p">();</span>
</pre></div>
</div>
<p class="rubric">Notas al pie</p>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>O sea, una clase de icono a partir de la cual se crearán los iconos
particulares de cada marca.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Estamos reproduciendo la definición anterior, pero en este caso debemos
añadir un contenedor <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code> extra.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>El por qué se usa la clase «<em>.chupachups</em>» en este trozo de <abbr title="Cascading Style Sheets">CSS</abbr> se
descubrirá más adelante.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td>Tenga presente que <a class="reference external" href="https://leafletjs.com/">Leaflet</a> envuelve la definición que con <code class="docutils literal notranslate"><span class="pre">html</span></code> o
<code class="docutils literal notranslate"><span class="pre">url</span></code> hayamos hecho en un elemento <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>, y es este elemento el que
representa <code class="docutils literal notranslate"><span class="pre">this</span></code>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[5]</a></td><td>Lo que no se incluye es el tiempo de descarga del fichero de datos que es
anterior a todo el proceso.</td></tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="02.lib.html" class="btn btn-neutral float-right" title="3.2. API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="3. Documentación de desarrollo" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, José Miguel Sánchez Alés/José Manuel Bermudo Ancio

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>